


<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>batch &mdash; GMT 6.1.1 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/style.css" type="text/css" />

  
  
    <link rel="shortcut icon" href="_static/favicon.png"/>
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="begin" href="begin.html" />
    <link rel="prev" title="basemap" href="basemap.html" />


  <!-- Point to the *latest* version switcher. This will allow the latest versions to appear on older documentation. -->
  <script type="text/javascript" src="/latest/_static/version_switch.js"></script>


</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> GMT
          

          
          </a>

          
            
            
              <div class="version">
                6.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
    
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="gallery.html">Example Gallery</a></li>
<li class="toctree-l1"><a class="reference internal" href="animations.html">Animations</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">Tutorial</a></li>
</ul>
<p class="caption"><span class="caption-text">Reference documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="modules.html">Modules</a></li>
<li class="toctree-l1"><a class="reference internal" href="cookbook.html">Cookbook</a></li>
<li class="toctree-l1"><a class="reference internal" href="datasets.html">Datasets</a></li>
</ul>
<p class="caption"><span class="caption-text">Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="users-contrib-scripts.html">Users Script Contributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="users-contrib-symbols.html">Users Symbol Contributions</a></li>
<li class="toctree-l1"><a class="reference internal" href="changes.html">Changelog</a></li>
<li class="toctree-l1"><a class="reference internal" href="deprecated-defaults.html">Deprecated GMT Defaults Names</a></li>
<li class="toctree-l1"><a class="reference internal" href="switching.html">Switching between different versions</a></li>
<li class="toctree-l1"><a class="reference internal" href="migrating.html">Migrating from an earlier version</a></li>
</ul>
<p class="caption"><span class="caption-text">Classic Mode</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="std-opts-classic.html">Common Options (Classic Mode)</a></li>
<li class="toctree-l1"><a class="reference internal" href="modules-classic.html">Modules (Classic Mode)</a></li>
</ul>
<p class="caption"><span class="caption-text">Developer Resources</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/GenericMappingTools/gmt/blob/master/CONTRIBUTING.md">Contributing Guide</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/GenericMappingTools/gmt/blob/master/CODE_OF_CONDUCT.md">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="rst-cheatsheet.html">reStructuredText Cheatsheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="debug.html">Debugging GMT</a></li>
<li class="toctree-l1"><a class="reference internal" href="api.html">GMT C API</a></li>
<li class="toctree-l1"><a class="reference internal" href="postscriptlight.html">PostScriptLight C API</a></li>
</ul>

            
          

    
        <p class="caption">
            <span class="caption-text">Getting help</span>
        </p>
        <ul>
            
                <li class="toctree-l1"><a href="https://www.generic-mapping-tools.org/"><i class="fa fa-home fa-fw"></i> GMT Homepage</a></li>
            
                <li class="toctree-l1"><a href="https://forum.generic-mapping-tools.org/"><i class="fa fa-comment fa-fw"></i> GMT Community Forum</a></li>
            
                <li class="toctree-l1"><a href="https://github.com/GenericMappingTools/gmt/blob/master/LICENSE.TXT"><i class="fa fa-book fa-fw"></i> License</a></li>
            
                <li class="toctree-l1"><a href="https://github.com/GenericMappingTools/gmt"><i class="fa fa-github fa-fw"></i> Source Code</a></li>
            
        </ul>
    

        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">GMT</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="modules.html">Modules</a> &raquo;</li>
        
      <li>batch</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            
              <a href="https://github.com/GenericMappingTools/gmt/edit/6.1/doc/rst/source/batch.rst" class="fa fa-github"> Edit on GitHub</a>
            
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <span class="target" id="index-0"></span><div class="section" id="batch">
<h1>batch<a class="headerlink" href="#batch" title="Permalink to this headline">¶</a></h1>
<p>Automate batch job processing</p>
<div class="section" id="synopsis">
<h2>Synopsis<a class="headerlink" href="#synopsis" title="Permalink to this headline">¶</a></h2>
<p><strong>gmt batch</strong> <em>mainscript</em>
<a class="reference internal" href="#n"><span> <strong>-N</strong></span></a></strong><em>prefix</em>
<a class="reference internal" href="#t"><span> <strong>-T</strong></span></a></strong><em>njobs</em>|<em>min</em>/<em>max</em>/<em>inc</em>[<strong>+n</strong>]|<em>timefile</em>[<strong>+p</strong><em>width</em>][<strong>+s</strong><em>first</em>][<strong>+w</strong>[<em>str</em>]]
[ <a class="reference internal" href="#i"><span> <strong>-I</strong></span></a></strong><em>includefile</em> ]
[ <a class="reference internal" href="#m"><span> <strong>-M</strong></span></a></strong>[<em>job</em>] ]
[ <a class="reference internal" href="#q"><span> <strong>-Q</strong></span></a></strong>[<strong>s</strong>] ]
[ <strong>-Sb</strong><em>preflight</em> ]
[ <strong>-Sf</strong><em>postflight</em> ]
[ <a class="reference internal" href="#v"><span> <strong>-V</strong></span></a></strong>[<em>level</em>] ]
[ <a class="reference internal" href="#w"><span> <strong>-W</strong></span></a></strong>[<em>workdir</em>] ]
[ <a class="reference internal" href="#z"><span> <strong>-Z</strong></span></a></strong> ]
[ <strong>-x</strong>[[-]<em>n</em>] ]
[ <strong>--PAR</strong>=<em>value</em> ]</p>
<p><strong>Note:</strong> No space is allowed between the option flag and the associated arguments.</p>
</div>
<div class="section" id="description">
<h2>Description<a class="headerlink" href="#description" title="Permalink to this headline">¶</a></h2>
<p>The <strong>batch</strong> module can generate GMT processing jobs using a single master script
that is repeated for all jobs, with some variation using specific job variables.  The
module simplifies (and hides) most of the steps normally needed to set up a full-blown
processing sequence.  Instead, the user can focus on composing the main processing script and let the
parallel execution of jobs be automatic.  We can set up required data sets and do one-time calculations
via an optional <em>preflight</em> script.  After completion we can optionally assemble the data output
and make summary plots or similar in the <em>postflight</em> script.</p>
</div>
<div class="section" id="required-arguments">
<h2>Required Arguments<a class="headerlink" href="#required-arguments" title="Permalink to this headline">¶</a></h2>
<dl class="simple">
<dt><em>mainscript</em></dt><dd><p>Name of a stand-alone GMT modern mode processing script that makes the parameter-dependent calculations.  The
script may access job variables, such as job number and others defined below, and may be
written using the Bourne shell (.sh), the Bourne again shell (.bash), the csh (.csh)
or DOS batch language (.bat).  The script language is inferred from the file extension
and we build hidden batch scripts using the same language.  Parameters that can be accessed
are discussed below.</p>
</dd>
</dl>
<dl class="simple" id="n">
<dt><strong>-N</strong><em>prefix</em></dt><dd><p>Determines the prefix of the batch file products and the final sub-directory with all job products.</p>
</dd>
</dl>
<dl class="simple" id="t">
<dt><strong>-T</strong><em>njobs</em>|<em>min</em>/<em>max</em>/<em>inc</em>[<strong>+n</strong>]|<em>timefile</em>[<strong>+p</strong><em>width</em>][<strong>+s</strong><em>first</em>][<strong>+w</strong>[<em>str</em>]]</dt><dd><p>Either specify how many jobs to make, create a one-column data set width values from
<em>min</em> to <em>max</em> every <em>inc</em> (append <strong>+n</strong> if <em>inc</em> is number of jobs instead), or supply a file with
a set of parameters, one record (i.e., row) per job.  The values in the columns will be available to the
<em>mainscript</em> as named variables <strong>BATCH_COL0</strong>, <strong>BATCH_COL1</strong>, etc., while any trailing text
can be accessed via the variable <strong>BATCH_TEXT</strong>.  Append <strong>+w</strong> to split the trailing
string into individual <em>words</em> that can be accessed via variables <strong>BATCH_WORD0</strong>, <strong>BATCH_WORD1</strong>,
etc. By default we use any white-space to separate words.  Append <em>str</em> to select another character(s)
as the valid separator(s). The number of records equals the number of jobs. Note that the <em>preflight</em> script is allowed to
create <em>timefile</em>, hence we check for its existence both before <em>and</em> after the <em>preflight</em> script has
completed.  Normally, the job numbering starts at 0; you can change this by appending a different starting
job number via <strong>+s</strong><em>first</em>.  <strong>Note</strong>: All jobs are still included; this modifier only affects
the numbering of the given jobs.  Finally, <strong>+p</strong> can be used to set the tag <em>width</em> of the format
used in naming jobs.  For instance, name_000010.grd has a tag width of 6.  By default, this is
automatically set but if you are splitting large jobs across several computers (via <strong>+s</strong>) then you
must use the same tag width for all names.</p>
</dd>
</dl>
</div>
<div class="section" id="optional-arguments">
<h2>Optional Arguments<a class="headerlink" href="#optional-arguments" title="Permalink to this headline">¶</a></h2>
<dl class="simple" id="i">
<dt><strong>-I</strong><em>includefile</em></dt><dd><p>Insert the contents of <em>includefile</em> into the batch_init.sh script that is accessed by all batch scripts.
This mechanism is used to add information (typically constant variable assignments) that the <em>mainscript</em>
and any optional <strong>-S</strong> scripts can rely on.</p>
</dd>
</dl>
<dl class="simple" id="m">
<dt><strong>-M</strong>[<em>job</em>]</dt><dd><p>Instead of making and launching the full processing sequence, select a single master job [0] for testing.
The master job will be run and its product(s) are placed in the top directory. While any <em>preflight</em> script
will be run prior to the master job, the <em>postflight</em> script will not be executed (but it will be created).</p>
</dd>
</dl>
<dl class="simple" id="q">
<dt><strong>-Q</strong>[<strong>s</strong>]</dt><dd><p>Debugging: Leave all files and directories we create behind for inspection.  Alternatively, append <strong>s</strong> to
only build the batch scripts but <em>not</em> perform any executions.  One exception involves the optional
<em>preflight</em> script derived from <strong>-Sb</strong> which is always executed since it may produce data needed when
building the main batch (or master) scripts.</p>
</dd>
</dl>
<dl class="simple" id="sb">
<dt><strong>-Sb</strong><em>preflight</em></dt><dd><p>The optional GMT modern mode <em>preflight</em> (written in the same scripting language as <em>mainscript</em>) can be
used to download or copy data files or create files (such as <em>timefile</em>) that will be needed by <em>mainscript</em>.
It is always run <strong>b</strong>efore the main sequence of batch scripts.</p>
</dd>
</dl>
<dl class="simple" id="sf">
<dt><strong>-Sf</strong><em>postflight</em></dt><dd><p>The optional <em>postflight</em> (written in the same scripting language as <em>mainscript</em>) can be
used to perform final processing steps <strong>f</strong>ollowing the completion of all the individual jobs, such as
assembling all the products into a single larger file.  The script may also make one or more illustrations
using the products or stacked data after the main processing is completed. It does not have to be a GMT
script.</p>
</dd>
</dl>
<dl class="simple" id="batch-v">
<dt><strong>-V</strong>[<em>level</em>] <a class="reference internal" href="gmt.html#v-full"><span class="std std-ref">(more …)</span></a></dt><dd><p>Select verbosity level [<strong>w</strong>].  </p>
</dd>
</dl>
<dl class="simple" id="w">
<dt><strong>-W</strong>[<em>workdir</em>]</dt><dd><p>By default, all temporary files and job products are created in the subdirectory <em>prefix</em> set via <strong>-N</strong>.
You can override that selection by giving another <em>workdir</em> as a relative or full directory path. If no
path is given then we create a working directory in the system temp folder named <em>prefix</em>.  The main benefit
of a working directory is to avoid endless syncing by agents like DropBox or TimeMachine, or to avoid
problems related to low space in the main directory.  The product files will still be placed in the <em>prefix</em>
directory.  The <em>workdir</em> is removed unless <strong>-Q</strong> is specified for debugging.</p>
</dd>
</dl>
<dl class="simple" id="z">
<dt><strong>-Z</strong></dt><dd><p>Erase the <em>mainscript</em> and all input scripts given via <strong>-I</strong> and <strong>-S</strong> upon completion.  Not compatible
with <strong>-Q</strong>.</p>
</dd>
</dl>
<dl class="simple" id="cores">
<dt><strong>-x</strong>[[-]<em>n</em>]</dt><dd><p>Limit the number of cores to use when loading up the cores.
By default we try to use all available cores.  Append <em>n</em> to only use <em>n</em> cores
(if too large it will be truncated to the maximum cores available).  Finally,
give a negative <em>n</em> to select (all - <em>n</em>) cores (or at least 1 if <em>n</em> equals or exceeds all).
The parallel processing does not depend on OpenMP; new jobs are launched when the previous ones
complete.</p>
</dd>
</dl>
<dl class="simple">
<dt><strong>-^</strong> or just <strong>-</strong></dt><dd><p>Print a short message about the syntax of the command, then exit (NOTE: on Windows just use <strong>-</strong>).</p>
</dd>
<dt><strong>-+</strong> or just <strong>+</strong></dt><dd><p>Print an extensive usage (help) message, including the explanation of
any module-specific option (but not the GMT common options), then exit.</p>
</dd>
<dt><strong>-?</strong> or no arguments</dt><dd><p>Print a complete usage (help) message, including the explanation of all options, then exit.</p>
</dd>
<dt><strong>--PAR</strong>=<em>value</em></dt><dd><p>Temporarily override a GMT default setting; repeatable. See <a class="reference internal" href="gmt.conf.html"><span class="doc">gmt.conf</span></a> for parameters.</p>
</dd>
</dl>
</div>
<div class="section" id="parameters">
<h2>Parameters<a class="headerlink" href="#parameters" title="Permalink to this headline">¶</a></h2>
<p>Several parameters are automatically assigned and can be used when composing the <em>mainscript</em> and the
optional <em>preflight</em> and <em>postflight</em> scripts. There are two sets of parameters: Those that are constants
and those that change with the job number.  The constants are accessible by all the scripts:
<strong>BATCH_PREFIX</strong>: The common prefix of the batch jobs (it is set with <strong>-N</strong>). <strong>BATCH_NJOBS</strong>: The
total number of jobs (given or inferred from <strong>-T</strong>). Also, if <strong>-I</strong> was used then any static parameters
listed therein will be available to all the scripts as well. In addition, the <em>mainscript</em> also has access
to parameters that vary with the job counter: <strong>BATCH_JOB</strong>: The current job number (an integer, e.g., 136),
<strong>BATCH_TAG</strong>: The formatted job number given the precision (a string, e.g., 000136), and <strong>BATCH_NAME</strong>:
The name prefix unique to the current job (i.e., <em>prefix</em>_<strong>BATCH_TAG</strong>), Furthermore, if a <em>timefile</em>
was given then variables <strong>BATCH_COL0</strong>, <strong>BATCH_COL1</strong>, etc. are also set, yielding one variable per
column in <em>timefile</em>.  If <em>timefile</em> has trailing text then that text can be accessed via the variable
<strong>BATCH_TEXT</strong>, and if word-splitting was explicitly requested by <strong>+w</strong> modifier to <strong>-T</strong> then the trailing
text is also split into individual word parameters <strong>BATCH_WORD0</strong>, <strong>BATCH_WORD1</strong>, etc. <strong>Note</strong>: Any
product(s) made by the processing scripts should be named using <strong>BATCH_NAME</strong> as their name prefix as these
will be automatically moved up to the starting directory upon completion.</p>
</div>
<div class="section" id="data-files">
<h2>Data Files<a class="headerlink" href="#data-files" title="Permalink to this headline">¶</a></h2>
<p>The batch scripts will be able to find any files present in the starting directory when <strong>batch</strong> was initiated,
as well as any new files produced by <em>mainscript</em> or the optional scripts set via <strong>-S</strong>.
No path specification is needed to access these files.  Other files may
require full paths unless their directories were already included in the <a class="reference internal" href="gmt.conf.html#term-DIR_DATA"><span class="xref std std-term">DIR_DATA</span></a> setting.</p>
</div>
<div class="section" id="constructing-the-main-script">
<h2>Constructing the Main Script<a class="headerlink" href="#constructing-the-main-script" title="Permalink to this headline">¶</a></h2>
<p>A batch sequence is not very interesting if nothing changes between calls.  For the process to change you need
to have your <em>mainscript</em> either access a <em>different</em> data set as the job number changes, or you need to access
only a varying <em>subset</em> of a data set, or the processing parameters need to change, or all of the above.  There
are several strategies you can use to accomplish these effects:</p>
<ol class="arabic simple">
<li><p>Your <em>timefile</em> passed to <strong>-T</strong> may list names of specific data files and you simply have your <em>mainscript</em>
use the relevant <strong>BATCH_TEXT</strong> or <strong>BATCH_WORD?</strong> to access the job-specific file name.</p></li>
<li><p>You have a 3-D grid (or a stack of 2-D grids) and you want to interpolate along the axis perpendicular to the
2-D slices (e.g., time, or it could be depth).  In this situation you will use the module <a class="reference internal" href="grdinterpolate.html"><span class="doc">grdinterpolate</span></a>
to have the <em>mainscript</em> obtain a slice for the correct time (this may be an interpolation between two different
times or depths) and process this temporary grid file.</p></li>
<li><p>You may be creating data on the fly using <a class="reference internal" href="gmtmath.html"><span class="doc">gmtmath</span></a> or <a class="reference internal" href="grdmath.html"><span class="doc">grdmath</span></a>, or perhaps processing data slightly
differently per job (using parameters in the <em>timefile</em>) and computing these or the changes between jobs.</p></li>
<li><p>Use your imagination to pass whatever arguments are needed via <em>timefile</em>.</p></li>
</ol>
</div>
<div class="section" id="technical-details">
<h2>Technical Details<a class="headerlink" href="#technical-details" title="Permalink to this headline">¶</a></h2>
<p>The <strong>batch</strong> module creates several hidden script files that are used in the generation of the products
(here we have left the script file extension off since it depends on the scripting language used): <em>batch_init</em>
(initializes variables related to the overall batch job and includes the contents of the optional <em>includefile</em>),
<em>batch_preflight</em> (optional since it derives from <strong>-Sb</strong> and computes or prepares needed data files), <em>batch_postflight</em>
(optional since it derives from <strong>-Sf</strong> and processes files once all the batch job complete), <em>batch_job</em>
(accepts a job counter argument and processes data for those parameters), and <em>batch_cleanup</em> (removes temporary
files at the end of the process). For each job, there is a separate <em>batch_params_######</em> script that provides
job-specific variables (e.g., job number and anything given via <strong>-T</strong>).  The <em>preflight</em> and <em>postflight</em> scripts
have access to the information in <em>batch_init</em>, while the <em>batch_job</em> script in addition has access to the job-specific
parameter file.  Using the <strong>-Q</strong> option will just produce these scripts which you can then examine.
<strong>Note</strong>: The <em>mainscript</em> is duplicated per job and many of these are run simultaneously on all available cores.
Multi-treaded GMT modules will therefore be limited to a single core per call.  Because we do not know how
many products each batch job makes, we ensure each job creates a unique file when it is finished.  Checking for
these special (and empty) files is how <strong>batch</strong> learns that a particular job has completed and it is time to
launch another one.</p>
</div>
<div class="section" id="hints-for-batch-makers">
<h2>Hints for Batch Makers<a class="headerlink" href="#hints-for-batch-makers" title="Permalink to this headline">¶</a></h2>
<p>Composing batch jobs is relatively simple, but you have to think in terms of <em>variables</em>. Examine the examples
we describe.  Then, start by making a single script (i.e., your <em>mainscript</em>) and identify which
things should change with time (i.e., with the job number).  Create variables for these values. If they
are among the listed parameters that <strong>batch</strong> creates automatically then use those names.  Unless you only
require the job number you will need to make a file that you can pass via <strong>-T</strong>.  This file should
then have all the values you need, per job (i.e., per row), with values across all the columns you need.
If you need to assign various <em>fixed</em> variables that do not change with time, then your <em>mainscript</em>
will look shorter and cleaner if you offload those assignments to a separate <em>includefile</em> (via <strong>-I</strong>).
To test your <em>mainscript</em>, start by using options <strong>-Q -M</strong> to ensure that your master job results are correct.
The <strong>-M</strong> option simply runs one job of your batch sequence (you can select which one via the <strong>-M</strong>
arguments [0]).  Fix any issues with your use of variables and options until this works.  You can then try
to remove <strong>-Q</strong>. We recommend you make a very short (i.e., via <strong>-T</strong>) and small batch sequence so you don’t
have to wait very long to see the result.  Once things are working you can beef up number of jobs.</p>
</div>
<div class="section" id="examples">
<h2>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h2>
<p>We extract a subset of bathymetry for the Gulf of Guinea from the 2x2 arc minute resolution Earth DEM and compute
Gaussian filtered high-pass grids using filter widths ranging from 10 to 200 km in steps of 10 km. When the grids
are all completed we determine the standard deviation in the result.  To replicate our setup, try:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat <span class="s">&lt;&lt; EOF &gt; pre.sh</span>
<span class="s">gmt begin</span>
<span class="s">    gmt math -o0 -T10/200/10 T = widths.txt</span>
<span class="s">    gmt grdcut -R-10/20/-10/20 @earth_relief_02m -Gdata.grd</span>
<span class="s">gmt end</span>
<span class="s">EOF</span>
cat <span class="s">&lt;&lt; EOF &gt; main.sh</span>
<span class="s">gmt begin</span>
<span class="s">    gmt grdfilter data.grd -Fg\${BATCH_COL0}+h -G\${BATCH_NAME}.grd -D2</span>
<span class="s">gmt end</span>
<span class="s">EOF</span>
cat <span class="s">&lt;&lt; EOF &gt; post.sh</span>
<span class="s">gmt begin \${BATCH_PREFIX} pdf</span>
<span class="s">    gmt grdmath \${BATCH_PREFIX}_*.grd -S STD = \${BATCH_PREFIX}_std.grd</span>
<span class="s">    gmt grdimage \${BATCH_PREFIX}_std.grd -B -B+t&quot;STD of Gaussians residuals&quot; -Chot</span>
<span class="s">    gmt coast -Wthin,white</span>
<span class="s">gmt end show</span>
<span class="s">EOF</span>
gmt batch main.sh -Sbpre.sh -Sfpost.sh -Twidths.txt -Nfilter -V -Z
</pre></div>
</div>
<p>Of course, the syntax of how variables are used vary according to the scripting language. Here, we actually
build the pre.sh, main.sh, and post.sh scripts on the fly, hence we need to escape any variables (since they
start with a dollar sign that we need to be written verbatim). At the end of the execution we find 20 grids
(e.g., such as filter_07.grd), as well as the filter_std.grd file obtained by stacking all the individual
scripts and computing a standard deviation. The information needed to do all of this is hidden from the user;
the actual batch scripts that we execute are derived from the user-provided main.sh script and <strong>batch*</strong>
supplies the extra machinery. The <strong>batch</strong> module automatically manages the parallel execution loop over all
jobs using all available cores and launches new jobs as old ones complete.</p>
<p>As another example, we get a list of all European countries and make a simple coast plot of each of them,
placing their name in the title and the 2-character ISO code in the upper left corner, then in postflight
we combine all the individual PDFs into a single file and delete them:</p>
<div class="highlight-bash notranslate"><div class="highlight"><pre><span></span>cat <span class="s">&lt;&lt; EOF &gt; pre.sh</span>
<span class="s">gmt begin</span>
<span class="s">    gmt coast -E=EU+l &gt; countries.txt</span>
<span class="s">gmt end</span>
<span class="s">EOF</span>
cat <span class="s">&lt;&lt; EOF &gt; main.sh</span>
<span class="s">gmt begin \${BATCH_NAME} pdf</span>
<span class="s">    gmt coast -R\${BATCH_WORD0}+r2 -JQ10c -Glightgray -Slightblue -B -B+t&quot;\${BATCH_WORD1}&quot; -E\${BATCH_WORD0}+gred+p0.5p</span>
<span class="s">    echo \${BATCH_WORD0} | gmt text -F+f16p+jTL+cTL -Gwhite -W1p</span>
<span class="s">gmt end</span>
<span class="s">EOF</span>
cat <span class="s">&lt;&lt; EOF &gt; post.sh</span>
<span class="s">gs -dQUIET -dNOPAUSE -sDEVICE=pdfwrite -sOUTPUTFILE=\${BATCH_PREFIX}.pdf -dBATCH \${BATCH_PREFIX}_*.pdf</span>
<span class="s">rm -f \${BATCH_PREFIX}_*.pdf</span>
<span class="s">EOF</span>
gmt batch main.sh -Sbpre.sh -Sfpost.sh -Tcountries.txt+w<span class="s2">&quot;\t&quot;</span> -Ncountries -V -W -Zs
</pre></div>
</div>
<p>Here, the postflight script is not even a GMT script; it simply runs gs and deletes what we don’t want.</p>
</div>
<div class="section" id="see-also">
<h2>See Also<a class="headerlink" href="#see-also" title="Permalink to this headline">¶</a></h2>
<p><a class="reference internal" href="gmt.html"><span class="doc">gmt</span></a>,
<a class="reference internal" href="gmtmath.html"><span class="doc">gmtmath</span></a>,
<a class="reference internal" href="grdinterpolate.html"><span class="doc">grdinterpolate</span></a>,
<a class="reference internal" href="grdmath.html"><span class="doc">grdmath</span></a></p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="begin.html" class="btn btn-neutral float-right" title="begin" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="basemap.html" class="btn btn-neutral float-left" title="basemap" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, The GMT Team.
      <span class="lastupdated">
        Last updated on Sep 02, 2020.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(false);
      });
  </script>

  
  
    
   

</body>
</html>