#include "common_options.txt"
.TH GRDMATH 1 MANDATE GMT_STRING "Generic Mapping Tools"
.SH NAME
grdmath \- Reverse Polish Notation calculator for grid files
.SH SYNOPSIS
\fBgrdmath\fP [ OPT(F) ] [ GMT_I_OPT ] [ OPT(M) ] [ OPT(N) ] [ GMT_Rgeo_OPT ] [ GMT_V_OPT ] [ GMT_bi_OPT ] [ GMT_fi_OPT ] 
\fIoperand\fP [ \fIoperand\fP ] \fBOPERATOR\fP [ \fIoperand\fP ] \fBOPERATOR\fP ... \fB=\fP \fIoutgrdfile\fP
.SH DESCRIPTION
\fBgrdmath\fP will perform operations like add, subtract, multiply, and divide
on one or more grid files or constants using Reverse Polish Notation (RPN)
syntax (e.g., Hewlett-Packard calculator-style).  Arbitrarily complicated expressions
may therefore be evaluated; the final result is written to an output grid file.
When two grids are on the stack, each element in file A is modified by the corresponding element in file B.
However, some operators only require one operand (see below).  If no grid files are used in the
expression then options OPT(R), OPT(I) must be set (and optionally OPT(F)).  The expression
\fB=\fP \fIoutgrdfile\fP can occur as many times as the depth of the stack allows.
.TP
\fIoperand\fP
If \fIoperand\fP can be opened as a file it will be read as a grid file.  If not a file, it is interpreted
as a numerical constant or a special symbol (see below).
.TP
\fIoutgrdfile\fP
The name of a 2-D grid file that will hold the final result.
(See GRID FILE FORMATS below).
.TP
.B OPERATORS
#include "grdmath_man.i"
.TP
.B SYMBOLS
The following symbols have special meaning:
.br
.sp
\fBPI\fP	3.1415926...
.br
\fBE \fP	2.7182818...
.br
\fBEULER \fP	0.5772156...
.br
\fBXMIN \fP	Minimum x value
.br
\fBXMAX \fP	Maximum x value
.br
\fBXINC \fP	x increment
.br
\fBNX \fP	The number of x nodes
.br
\fBYMIN \fP	Minimum y value
.br
\fBYMAX \fP	Maximum y value
.br
\fBYINC \fP	y increment
.br
\fBNY \fP	The number of y nodes
.br
\fBX \fP	Grid with x-coordinates
.br
\fBY \fP	Grid with y-coordinates
.br
\fBXn \fP	Grid with normalized [-1 to +1] x-coordinates
.br
\fBYn \fP	Grid with normalized [-1 to +1] y-coordinates
.SH OPTIONS
#include "explain_nodereg.txt"
Only used with OPT(R) OPT(I).
#include "explain_-I.txt"
.TP
OPT(M)
By default any derivatives calculated are in z_units/ x(or y)_units.
However, the user may choose this option to convert dx,dy in degrees of
longitude,latitude into meters using a flat Earth approximation, so that
gradients are in z_units/meter.
.TP
OPT(N)
Turn off strict domain match checking when multiple grids are manipulated [Default will insist
that each grid domain is within 1e-4 * grid_spacing of the domain of the first grid listed].
#include "explain_-R.txt"
#include "explain_-V.txt"
#include "explain_-bi.txt"
The binary input option only applies to the data files needed by operators \fBLDIST\fP, \fPPDIST\fP,
and \fBINSIDE\fP.
#include "explain_-f.txt"
.SH NOTES ON OPERATORS
(1) The operator \fBSDIST\fP calculates spherical distances between the (lon, lat)
point on the stack and all node positions in the grid.  The grid domain
and the (lon, lat) point are expected to be in degrees.  Similarly, the \fBSAZ\fP and \fBSBAZ\fP
operators calculate spherical azimuth and backazimuths in degrees, respectively.
Note: If the current \fBELLIPSOID\fP is not spherical then geodesics are used in the calculations.
.br
.sp
(2) The operator \fBPLM\fP calculates the associated Legendre polynomial
of degree L and order M (0 <= M <= L), and its argument is the sine of the latitude.
\fBPLM\fP is not normalized and includes the Condon-Shortley phase (-1)^M.
\fBPLMg\fP is normalized in the way that is most commonly used in geophysics.
The C-S phase can be added by using -M as argument.
\fBPLM\fP will overflow at higher degrees, whereas \fBPLMg\fP is stable until ultra high degrees (at
least 3000).
.br
.sp
(3) The operators \fBYLM\fP and \fBYLMg\fP calculate normalized spherical harmonics for degree L and
order M (0 <= M <= L) for all positions in the grid, which is assumed to be in degrees.
\fBYLM\fP and \fBYLMg\fP return two grids, the real (cosine) and imaginary (sine) component
of the complex spherical harmonic.  Use the \fBPOP\fP operator (and \fBEXCH\fP) to
get rid of one of them, or save both by giving two consecutive = file.grd calls.
.br
The orthonormalized complex harmonics \fBYLM\fP are most commonly used in physics and seismology.
The square of \fBYLM\fP integrates to 1 over a sphere.
In geophysics, \fBYLMg\fP is normalized to produce unit power when averaging the cosine and sine terms
(separately!) over a sphere (i.e. their squares each integrate to 4 pi).
The Condon-Shortley phase (-1)^M is not included in \fBYLM\fP or \fBYLMg\fP, but it can be added by using -M
as argument.
.br
.sp
(4) All the derivatives are based on central finite differences, with natural boundary conditions.
.br
.sp
(5) Files that have the same names as some operators, e.g., \fBADD\fP, \fBSIGN\fP, \fB=\fP, etc. should be
identified by prepending the current directory (i.e., ./LOG).
.br
.sp
(6) Piping of files is not allowed.
.br
.sp
(7) The stack depth limit is hard-wired to 100.
.br
.sp
(8) All functions expecting a positive radius (e.g., \fBLOG\fP, \fBKEI\fP, etc.) are passed the
absolute value of their argument.
#include "explain_float.txt"
#include "explain_grd_inout.txt"
#include "explain_grd_coord.txt"
.SH EXAMPLES
To take log10 of the average of 2 files, use
.br
.sp
\fBgrdmath\fP file1.grd file2.grd \fBADD\fP 0.5 \fBMUL LOG10 =\fP file3.grd
.br
.sp
Given the file ages.grd, which holds seafloor ages in m.y., use the relation
depth(in m) = 2500 + 350 * sqrt (age) to estimate normal seafloor depths:
.br
.sp
\fBgrdmath\fP ages.grd \fBSQRT\fP 350 \fBMUL \fP2500 \fBADD =\fP depths.grd
.br
.sp
To find the angle a (in degrees) of the largest principal stress from the stress tensor given by the
three files s_xx.grd s_yy.grd, and s_xy.grd from the relation tan (2*a) = 2 * s_xy / (s_xx - s_yy), use
.br
.sp
\fBgrdmath\fP 2 s_xy.grd \fBMUL\fP s_xx.grd s_yy.grd \fBSUB DIV ATAN2\fP 2 \fBDIV =\fP direction.grd
.br
.sp
To calculate the fully normalized spherical harmonic of degree 8 and order
4 on a 1 by 1 degree world map, using the real amplitude 0.4 and the
imaginary amplitude 1.1:
.br
.sp
\fBgrdmath\fP OPT(R)0/360/-90/90 OPT(I)1 8 4 \fBYML\fP 1.1 \fBMUL EXCH\fP 0.4 \fBMUL ADD\fP = harm.grd
.br
.sp
To extract the locations of local maxima that exceed 100 mGal in the file faa.grd:
.br
.sp
\fBgrdmath\fP faa.grd \fBDUP EXTREMA\fP 2 \fBEQ MUL DUP\fP 100 \fBGT MUL\fP 0 \fBNAN\fP = z.grd
.br
\fBgrd2xyz\fP z.grd OPT(S) > max.xyz
.SH REFERENCES
Abramowitz, M., and I. A. Stegun, 1964, \fIHandbook of Mathematical
Functions\fP, Applied Mathematics Series, vol. 55, Dover, New York.
.br
Holmes, S. A., and W. E. Featherstone, 2002, A unified approach to the Clenshaw summation and the
recursive computation of very high degree and order normalised associated Legendre functions.
\fIJournal of Geodesy\fP, 76, 279-299.
.br
Press, W. H.,  S. A. Teukolsky, W. T. Vetterling, and B. P. Flannery, 1992, 
\fINumerical Recipes\fP, 2nd edition, Cambridge Univ., New York.
.br
Spanier, J., and K. B. Oldman, 1987,
\fIAn Atlas of Functions\fP, Hemisphere Publishing Corp.
.SH "SEE ALSO"
.IR GMT (1),
.IR gmtmath (1),
.IR grd2xyz (1),
.IR grdedit (1),
.IR grdinfo (1),
.IR xyz2grd (1)
