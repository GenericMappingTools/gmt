#include "common_options.txt"
.TH GMTMATH 1 MANDATE GMT_STRING "Generic Mapping Tools"
.SH NAME
gmtmath \- Reverse Polish Notation calculator for data tables
.SH SYNOPSIS
\fBgmtmath\fP [ OPT(A)\fIt_f(t).d\fP ] [ OPT(C)\fIcols\fP ] [ OPT(F)\fIcols\fP ] [ GMT_H_OPT ] [ OPT(I) ] 
[ GMT_M_OPT ] [ OPT(N)\fIn_col\fP/\fIt_col\fP ] [ OPT(Q) ] [ OPT(S)[\fBf\fP|\fBl\fP] ] 
[ OPT(T)\fIt_min\fP/\fIt_max\fP/\fIt_inc\fP[\fB+\fP]|\fItfile\fP ] [ GMT_V_OPT ] [ GMT_b_OPT ] 
[ GMT_f_OPT ] \fIoperand\fP [ \fIoperand\fP ] \fBOPERATOR\fP [ \fIoperand\fP ] 
\fBOPERATOR\fP ... \fB=\fP [ \fIoutfile\fP ]
.SH DESCRIPTION
\fBgmtmath\fP will perform operations like add, subtract, multiply, and divide
on one or more table data files or constants using Reverse Polish Notation (RPN)
syntax (e.g., Hewlett-Packard calculator-style).  Arbitrarily complicated expressions
may therefore be evaluated; the final result is written to an output file
[or standard output].
When two data tables are on the stack, each element in file A is modified by the corresponding element in file B.
However, some operators only require one operand (see below).  If no data tables are used in the
expression then options OPT(T), OPT(N) can be set (and optionally OPT(b) to indicate the data domain).
If STDIN is given, <stdin> will be read and placed on the stack as if a file with that content
had been given on the command line.  By default, all columns except the
"time" column are operated on, but this can be changed (see OPT(C)).
.TP
\fIoperand\fP
If \fIoperand\fP can be opened as a file it will be read as an ASCII (or binary, see OPT(bi)) table data file.
If not a file, it is interpreted as a numerical constant or a special symbol (see below).  The special argument
STDIN means that \fIstdin\fP will be read and placed on the stack; STDIN can appear more than once if necessary.
.TP
\fIoutfile\fP
The name of a table data file that will hold the final result.  If not given then the output is sent to stdout.
.TP
.B OPERATORS
#include "gmtmath_man.i"
.TP
.B SYMBOLS
The following symbols have special meaning:
.br
.sp
\fBPI\fP	3.1415926...
.br
\fBE \fP	2.7182818...
.br
\fBEULER \fP	0.5772156...
.br
\fBTMIN \fP	Minimum t value
.br
\fBTMAX \fP	Maximum t value
.br
\fBTINC \fP	t increment
.br
\fBN \fP	The number of records
.br
\fBT \fP	Table with t-coordinates
.br
.SH OPTIONS
.TP
OPT(A)
Requires OPT(N) and will partially initialize a table with values from the given file containing
\fIt\fP and \fIf(t)\fP only.  The \fIt\fP is placed in column \fIt_col\fP while \fIf(t)\fP goes into
column \fIn_col\fP - 1 (see OPT(N)).
.TP
OPT(C)
Select the columns that will be operated on until next occurrence of OPT(C).
List columns separated by commas; ranges like 1,3-5,7 are allowed.  OPT(C)
(no arguments) resets the default action of using all columns except time column (see OPT(N)). 
OPT(Ca) selects all columns, including time column, while OPT(Cr) reverses (toggles) the current
choices.
.TP
OPT(F)
Give a comma-separated list of desired columns or ranges that should be part of the output
(0 is first column) [Default outputs all columns].
#include "explain_-H.txt"
.TP
OPT(I)
Reverses the output row sequence from ascending time to descending [ascending].
#include "explain_-M.txt"
.TP
OPT(N)
Select the number of columns and the column number that contains the
"time" variable.  Columns are numbered starting at 0 [2/0].
.TP
OPT(Q)
Quick mode for scalar calculation.  Shorthand for OPT(Ca) OPT(N)1/0 OPT(T)0/0/1.
.TP
OPT(S)
Only report the first or last row of the results [Default is all rows].  This is useful if
you have computed a statistic (say the \fBMODE\fP) and only want to report a single number
instead of numerous records with identical values.
Append \fBl\fP to get the last row and \fBf\fP to get the first row only
[Default].
.TP
OPT(T)
Required when no input files are given.  Sets the t-coordinates of the first
and last point and the equidistant sampling interval for the "time" column (see OPT(N)).
Append \fB+\fP if you are specifying the number of equidistant points instead.
If there is no time column (only data columns), give OPT(T) with no arguments; this
also implies OPT(Ca).  Alternatively, give the name of a file whose first column
contains the desired t-coordinates which may be irregular.
#include "explain_-V.txt"
#include "explain_-bi.txt"
#include "explain_-bo.txt"
[Default is same as input, but see OPT(F)]
#include "explain_precision.txt"
.SH NOTES ON OPERATORS
(1) The operators \fBPLM\fP and \fBPLMg\fP calculate the associated Legendre polynomial
of degree L and order M in x which must satisfy -1 <= x <= +1 and 0 <= M <= L.
x, L, and M are the three arguments preceding the operator.
\fBPLM\fP is not normalized and includes the Condon-Shortley phase (-1)^M.
\fBPLMg\fP is normalized in the way that is most commonly used in geophysics.
The C-S phase can be added by using -M as argument.
\fBPLM\fP will overflow at higher degrees, whereas \fBPLMg\fP is stable until ultra high degrees (at
least 3000).
.br
.sp
(2) Files that have the same names as some operators, e.g., \fBADD\fP, \fBSIGN\fP, \fB=\fP, etc. should be
identified by prepending the current directory (i.e., ./LOG).
.br
.sp
(3) The stack depth limit is hard-wired to 100.
.br
.sp
(4) All functions expecting a positive radius (e.g., \fBLOG\fP, \fBKEI\fP, etc.) are passed the
absolute value of their argument.
.br
.sp
(5) The \fBDDT\fP and \fBD2DT2\fP functions only work on regularly spaced data.
.br
.sp
(6) All derivatives are based on central finite differences, with natural
boundary conditions.
.br
.sp
(7) \fBROOTS\fP must be the last operator on the stack, only followed by \fB=\fP.
.SH EXAMPLES
To take the square root of the content of the second data column being piped through \fBgmtmath\fP
by process1 and pipe it through a 3rd process, use
.br
.sp
process1 | \fBgmtmath\fP STDIN \fBSQRT \=\fP | process3
.br
.sp
To take log10 of the average of 2 data files, use
.br
.sp
\fBgmtmath\fP file1.d file2.d \fBADD\fP 0.5 \fBMUL LOG10 \=\fP file3.d
.br
.sp
Given the file samples.d, which holds seafloor ages in m.y. and seafloor depth in m, use the relation
depth(in m) = 2500 + 350 * sqrt (age) to print the depth anomalies:
.br
.sp
\fBgmtmath\fP samples.d \fBT SQRT\fP 350 \fBMUL \fP2500 \fBADD SUB \=\fP | lpr
.br
.sp
To take the average of columns 1 and 4-6 in the three data sets sizes.1, sizes.2, and sizes.3, use
.br
.sp
\fBgmtmath\fP OPT(C)1,4-6 sizes.1 sizes.2 \fBADD\fP sizes.3 \fBADD 3 DIV \=\fP ave.d
.br
.sp
To take the 1-column data set ages.d and calculate the modal value and assign it to a variable, try
.br
.sp
set mode_age = `\fBgmtmath\fP OPT(S) OPT(T) ages.d \fBMODE \=\fP`
.br
.sp
To evaluate the dilog(x) function for coordinates given in the file t.d:
.br
.sp
\fBgmtmath\fP OPT(T)t.d \fBT DILOG \=\fP dilog.d
.br
.sp
To use gmtmath as a RPN Hewlett-Packard calculator on scalars (i.e., no input
files) and calculate arbitrary expressions, use the OPT(Q) option.
As an example, we will calculate the value of Kei (((1 + 1.75)/2.2) + cos (60))
and store the result in the shell variable z:
.br
.sp
set z = `\fBgmtmath\fP OPT(Q) 1 1.75 \fBADD\fP 2.2 \fBDIV\fP 60 \fBCOSD ADD KEI \=\fP`
.br
.sp
To use \fBgmtmath\fP as a general least squares equation solver, imagine that the current table is the
augmented matrix [ A | b ] and you want the least squares solution x to the matrix equation A * x = b.
The operator \fBLSQFIT\fP does this; it is your job to populate the matrix correctly first.  The OPT(A)
option will facilitate this.  Suppose you have a 2-column file ty.d with \fIt\fP and \fIb(t)\fP and you would
like to fit a the model y(t) = a + b*t + c*H(t-t0), where H is the Heaviside step function for a given t0 = 1.55.
Then, you need a 4-column augmented table loaded with t in column 0 and your observed y(t) in column 3.
The calculation becomes
.br
.sp
\fBgmtmath\fP OPT(N)4/1 OPT(A)ty.d \fB-C\fP0 1 \fBADD \-C\fP2 1.55 \fBSTEPT ADD \-Ca LSQFIT \=\fP solution.d
.br
.sp
Note we use the OPT(C) option to select which columns we are working on, then make active all the
columns we need (here all of them, with OPT(Ca)) before calling \fBLSQFIT\fP.  The second and fourth
columns (col numbers 1 and 3) are preloaded with t and y(t), respectively, the other columns are zero.  If you already have
a precalculated table with the augmented matrix [ A | b ] in a file (say lsqsys.d), the least squares
solution is simply
.br
.sp
\fBgmtmath\fP OPT(T) lsqsys.d \fBLSQFIT \=\fP solution.d
.SH REFERENCES
Abramowitz, M., and I. A. Stegun, 1964, \fIHandbook of Mathematical
Functions\fP, Applied Mathematics Series, vol. 55, Dover, New York.
.br
Holmes, S. A., and W. E. Featherstone, 2002,  A unified approach to the Clenshaw summation and the
recursive computation of very high degree and order normalised associated Legendre functions.
\fIJournal of Geodesy\fP, 76, 279-299.
.br
Press, W. H.,  S. A. Teukolsky, W. T. Vetterling, and B. P. Flannery, 1992, 
\fINumerical Recipes\fP, 2nd edition, Cambridge Univ., New York.
.br
Spanier, J., and K. B. Oldman, 1987,
\fIAn Atlas of Functions\fP, Hemisphere Publishing Corp.
.SH "SEE ALSO"
.IR GMT (1),
.IR grdmath (1)
